{% extends "base.html" %} {% block title %}API密钥状态 - Gemini Balance{%
endblock %} {% block head_extra_styles %}
<style>
  .key-content {
    transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out,
      padding 0.3s ease-in-out;
    overflow: hidden;
  }
  .key-content.collapsed {
    max-height: 0 !important;
    opacity: 0;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }
  .toggle-icon {
    transition: transform 0.3s ease;
  }
  .toggle-icon.collapsed {
    transform: rotate(-90deg);
  }
  .stats-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  .stats-card {
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }
  .stats-card-header {
    background-color: rgba(249, 250, 251, 0.95);
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .stats-card-title {
    display: flex;
    align-items: center;
    font-size: 1rem;
    font-weight: 600;
    color: #374151;
  }
  .stats-card-title i {
    margin-right: 0.5rem;
    color: #6b7280;
  }
  .stat-item {
    padding: 1rem;
    text-align: center;
  }
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
  }
  .stat-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #6b7280;
    margin-top: 0.25rem;
  }
  .key-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
  }
  .key-item {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 0.5rem;
    padding: 1rem;
    transition: all 0.3s ease;
  }
  .key-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  .key-actions button {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
  }
</style>
{% endblock %} {% block head_extra_scripts %}
<script src="/static/js/keys_status.js"></script>
{% endblock %} {% block content %}
<div class="container max-w-6xl mx-auto px-4">
  <div class="glass-card rounded-2xl shadow-xl p-6 md:p-8">
    <div class="absolute top-6 right-6 flex items-center gap-3">
      <button
        class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full w-8 h-8 flex items-center justify-center text-primary-600 transition-all duration-300"
        onclick="refreshPage(this)"
        title="手动刷新"
      >
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>

    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-4">
      <img src="/static/icons/logo.png" alt="Gemini Balance Logo" class="h-9 inline-block align-middle mr-2" />
      Gemini Balance - 监控面板
    </h1>

    <div class="nav-buttons-container flex justify-center mb-8 overflow-x-auto gap-2">
      <a href="/config" class="nav-link whitespace-nowrap flex items-center justify-center gap-2 px-6 py-3 font-medium rounded-lg text-gray-700 hover:text-gray-900 transition-all duration-200" style="background-color: rgba(229, 231, 235, 0.8)">
        <i class="fas fa-cog"></i> 配置编辑
      </a>
      <a href="/keys" class="main-nav-btn whitespace-nowrap flex items-center justify-center gap-2 px-6 py-3 font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200" style="background-color: #3b82f6 !important; color: #ffffff !important;">
        <i class="fas fa-tachometer-alt"></i> 监控面板
      </a>
      <a href="/logs" class="nav-link whitespace-nowrap flex items-center justify-center gap-2 px-6 py-3 font-medium rounded-lg text-gray-700 hover:text-gray-900 transition-all duration-200" style="background-color: rgba(229, 231, 235, 0.8)">
        <i class="fas fa-exclamation-triangle"></i> 错误日志
      </a>
    </div>

    <!-- New Stats Dashboard -->
    <div id="stats-dashboard" class="stats-dashboard animate-fade-in">
      <!-- Populated by JS -->
    </div>

    <!-- Key Buckets -->
    <div id="key-buckets" class="space-y-6">
      <!-- Populated by JS -->
    </div>

    <!-- API Usage Stats -->
    <div id="api-stats-container" class="stats-card mt-8">
        <div class="stats-card-header">
            <h3 class="stats-card-title"><i class="fas fa-chart-bar"></i> API 请求统计</h3>
        </div>
        <div id="api-stats" class="p-4 grid grid-cols-2 md:grid-cols-4 gap-4">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Global Action Buttons are removed, they will be per-bucket -->
  </div>
</div>

<!-- Modals (Reset, Delete, etc.) can remain here as they are generic -->
<div id="resetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full animate-fade-in">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-800" id="resetModalTitle">重置密钥</h3>
      <button onclick="closeResetModal()" class="text-gray-500 hover:text-gray-700 focus:outline-none"><i class="fas fa-times"></i></button>
    </div>
    <div class="mb-6"><p class="text-gray-600" id="resetModalMessage"></p></div>
    <div class="flex justify-end gap-3">
      <button onclick="closeResetModal()" class="px-3 py-1.5 text-xs font-medium bg-slate-500 hover:bg-slate-600 text-white rounded-lg transition-colors">取消</button>
      <button id="confirmResetBtn" class="px-3 py-1.5 text-xs font-medium bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">确认</button>
    </div>
  </div>
</div>

<!-- Key Usage Details Modal -->
<div id="keyUsageDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 shadow-xl max-w-lg w-full animate-fade-in">
        <div class="flex items-center justify-between mb-4 border-b pb-2">
            <h3 class="text-lg font-semibold text-gray-800" id="keyUsageDetailsModalTitle">密钥使用详情</h3>
            <button onclick="closeKeyUsageDetailsModal()" class="text-gray-500 hover:text-gray-700 focus:outline-none"><i class="fas fa-times"></i></button>
        </div>
        <div id="keyUsageDetailsContent" class="max-h-80 overflow-y-auto">
            <!-- Content will be populated by JS -->
        </div>
        <div class="flex justify-end mt-4 pt-2 border-t">
            <button onclick="closeKeyUsageDetailsModal()" class="px-4 py-2 text-sm font-medium bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg">关闭</button>
        </div>
    </div>
</div>
{% endblock %} {% block body_scripts %}
<script src="/static/js/keys_status.js"></script>
{% endblock %}
